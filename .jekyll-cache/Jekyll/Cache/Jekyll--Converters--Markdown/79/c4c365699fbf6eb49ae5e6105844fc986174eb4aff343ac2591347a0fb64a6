I"˙h<h2 id="introduction">Introduction</h2>
<p>Spring Data comes with a common programming model for persisting data in various types of database engine, ranging from traditional relational databases (SQL databases) to various types of NoSQL database engine, such as document databases (for example, MongoDB), key-value databases (for example, Redis), and graph databases (for example, Neo4J).</p>

<p>The two core concepts of the programming model in Spring Data are entities and repositories. Entities and repositories generalize how data is stored and accessed from the various types of database.</p>

<ul>
  <li><strong>Entity</strong>: An entity describes the data that will be stored by Spring Data. Entity classes are, in general, annotated with a mix of generic Spring Data annotations and annotations that are specific to each database technology. For example, an entity that will be stored in a relational database can be annotated with JPA annotations such as @Entity.  Each entity class generally represents a single database table, and an instance of such a class contains the data of a single table row. Each entity instance always has a unique object identifier, which is the same thing to an entity that a primary key is to a database table.</li>
  <li><strong>Repository</strong>: Repositories are used to store and access data from different types of database. In its most basic form, a repository can be declared as a Java interface, <code class="highlighter-rouge">Repository&lt;T,ID&gt;</code> where T is the type being stored and ID is a primary key type -  Spring Data will generate its implementation on the fly.  Spring Data also comes with some base Java interfaces, for example, <code class="highlighter-rouge">CrudRepository</code>, to make the definition of a repository even simpler. The base interface, CrudRepository, provides us with standard methods for create, read, update, and delete operations. If we want to use the repository, we can simply inject it (using @Autowired) and then start to use it.</li>
</ul>

<h2 id="object-relational-mapping-orm-and-java-persistence-api-jpa">Object-Relational Mapping (ORM) and Java Persistence API (JPA)</h2>
<p>Object-Relational Mapping (ORM) is a technique that allows you to fetch and manipulate from a database by using an object-oriented programming paradigm. ORM is really nice for programmers because it relies on object-oriented concepts, not on database structure. It also makes development much faster and reduces the amount of source code. ORM is mostly independent of the databases and developers don‚Äôt have to worry about vendor-specific SQL statements.</p>

<p>Java Persistent API (JPA) provides object-relational mapping for Java developers. The JPA entity is a Java class that presents the structure of a database table. The fields of an entity class present the columns of the database tables.</p>

<p>Hibernate is the most popular Java-based JPA implementation, and it is used in Spring Boot as a default. It is a mature product and it is widely used in large-scale applications.</p>

<h2 id="layers-of-a-persistence-tier">Layers of a Persistence Tier</h2>
<p>The application tier that deals with persistence is often called the persistence tier. Spring helps to enforce a modular architecture in which the persistence tier is divided into several core layers that contain the following:</p>
<ul>
  <li><strong>The domain model</strong>: The domain model represents the key entities within an application, defining the manner in which they relate to one another. Each entity defines a series of properties, which designates its characteristics, as well as its relationships to other entities. Each class within the domain model contains the various properties and associations that correlate to columns and relationships within the database. Part of Hibernate‚Äôs job is to convert between domain model instances and rows in the database.</li>
  <li><strong>The Data Access Object (DAO) layer</strong>:  DAO is a design pattern in which a data access object (DAO) is an object that provides an abstract interface to some type of database or other persistence mechanisms. The DAO layer defines the means for CRUD operations on the domain model data. A DAO helps to abstract away those details specific to a particular database or persistence technology, providing an interface for persistence behavior from the perspective of the domain model, while encapsulating explicit features of the persistence technology. The goal of the DAO pattern is to completely abstract the underlying persistence technology and the manner in which it loads, saves, and manipulates the data represented by the domain model. For example, if I have a Person domain entity, we might create a PersonDao class to define all the application‚Äôs persistence needs related to the Person entity- we would likely have a methods like findById(Long id) for loading a Person entity from the database using its unique identifier.When defining a DAO, it is good practice to first write the interface and it‚Äôs recommended to create separate DAOs for each persistent entity in your domain model.</li>
  <li><strong>The service layer</strong>: The layer that handles the application business logic is called the service layer. The service layer typically defines an application‚Äôs public-facing API. Service layer provides the logic to operate on the data sent to and from the DAO and the client. If the DAO layer manages the persistence of data, the service layer, on the other hand, exposes all DAO transactions through its own set of interfaces and implementations.</li>
</ul>

<h2 id="entity-mapping-a-database-table-to-a-java-class">Entity: Mapping a Database Table to a Java Class</h2>
<p>Let‚Äôs start with a simple example, where we map one database table to one JPA entity: below we have a STUDENT table with 4 columns:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">student_id</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
<span class="n">student_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
<span class="n">student_fulltime</span> <span class="nb">TINYINT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">student_age</span> <span class="nb">INT</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
</code></pre></div></div>
<p><br /></p>

<p>Below we have a Java Student class with 4 attributes that represents the above database table.</p>
<ul>
  <li>The class must be annotated with <code class="highlighter-rouge">@Entity</code>. Adding a JPA @Entity and @Id annotation to a POJO makes it a persistable object.</li>
  <li>Entities must have a unique identfier annotated with <code class="highlighter-rouge">@Id</code>. The id field is used to hold the database identity of each stored entity‚Äîthe primary key when using a relational database. Here, we are delegating the responsibility to generate unique values of the identity field to Spring Data. The primary key is defined by using the @Id annotation. The @GeneratedValue annotation defines that the ID is automatically generated by the database. We can also define our key generation strategy. Type AUTO means that the JPA provider selects the best strategy for a particular database. We don‚Äôt need an ID field in our constructor due to automatic ID generation.</li>
  <li><code class="highlighter-rouge">@Column</code> maps the class atributes to table columns. The database columns are named according to class field naming by default. If you want to use some other naming convention, you can use the @Column annotation. With the @Column annotation, you can also define the column‚Äôs length and whether the column is nullable.</li>
  <li><strong>Every persistent class must have a zero-argument (empty) constructor</strong>. You can either define this constructor yourself, or not write any constructors at all, which produces a default empty constructor.</li>
  <li>Each persistent class may have properties that represent the data which the class holds, defined as simple values, or other persistent classes, or both. These properties are usually defined as nonpublic instance variables, and are accessed through getters and setters which follow a specific naming convention. For example, for the Student class with the firstName property of type String, the getter and setter methods are respectively named getFirstName() and setFirstName(). Notice the lower-case f in the property name, and the upper-case F in the method names. The exception to this naming convention is Boolean properties, which uses a method called isXxx to look up their values. For example, the Student class might have methods called isGraduated() (which takes no arguments and returns a Boolean) and setGraduated() (which takes a Boolean and has a void return type), and would be said to have a Boolean property named graduated. (Again, notice the lower-case first letter in the property name.)</li>
</ul>

<p>JPA creates a database table called the name of the class when the application is initialized. If you want to use some other name for the database table, you can use the @Table annotation.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"STUDENT"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Student</span><span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span><span class="nc">GenerationType</span><span class="o">.</span><span class="na">AUTO</span><span class="o">)</span>
	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"student_id"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">studentId</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"student_name"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"student_fulltime"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="kt">boolean</span> <span class="n">fullTime</span><span class="o">;</span>

	<span class="nd">@Column</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">"student_age"</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Integer</span> <span class="n">age</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">Student</span><span class="o">(){}</span>

	<span class="kd">public</span> <span class="nf">Student</span> <span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">fullTime</span><span class="o">,</span> <span class="nc">Integer</span> <span class="n">age</span><span class="o">){</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">fullTime</span> <span class="o">=</span> <span class="n">fullTime</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="c1">//getters and setters logic here</span>
<span class="o">}</span>
</code></pre></div></div>
<p><br /></p>

<p>Now that we have define dthe object to relational mapping metadata, all of our database related coding can stay in the logical world because JPA will take care of the physical world for us.</p>

<h2 id="repository">Repository</h2>

<p>The Spring Boot Data JPA provides a CrudRepository interface for CRUD operations. It provides CRUD functionalities to our entity class. <strong><em>A repository is a ‚Äúdata access‚Äù pattern that contains methods for performing CRUD operations</em></strong>. We do this by creating a Java interface that provides CRUD operations for Student objects by extending the <code class="highlighter-rouge">CrudRepository&lt;Class_Name, ID_Type&gt;</code> interface:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">StudentRepository</span> <span class="kd">extends</span> <span class="nc">CrudRepository</span><span class="o">&lt;</span><span class="nc">Student</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{}</span>
</code></pre></div></div>
<p><br /></p>

<p>The preceding interface might appear empty, but the inherited methods inside CrudRepository provide the core CRUD operations we need. The interface is generically typed to match up with the domain class and the ID‚Äôs field type.</p>

<p>With this code in place, when Spring Boot creates an application context, Spring Data JPA will scan and discover our repository definition. Then it will automatically generate a concrete proxy that implements this interface. This saves us the labor of writing all these queries. Below are some useful methods that CrudRepository includes:</p>

<p>By inheriting from CrudRepository, we can call many methods without the need to implement them ourself. We can also define our own methods. These method names should use special keywords such as ‚Äúfind‚Äù, ‚Äúorder‚Äù with the name of the variables. Spring Data JPA developers have tried to take into account the majority of possible options that you might need. In our example for the Student entity, <code class="highlighter-rouge">findByStudentName(String student_name)</code> method returns all entries from the table with the specified student_name.</p>

<p><strong>Create Method</strong></p>
<ul>
  <li>Class_Name save(Class_Name object_variable)</li>
</ul>

<p><strong>Read Methods</strong></p>
<ul>
  <li>Optional<Class_Name> findById(ID id)</Class_Name></li>
  <li>boolean existsById(ID id)</li>
  <li>Iterable<Class_Name> findAll()</Class_Name></li>
  <li>findOne(ID id)</li>
  <li>Iterable<Class_Name> findAllById(Iterable<ID> iterable)</ID></Class_Name></li>
  <li>long count()</li>
</ul>

<p><strong>Update Method</strong></p>
<ul>
  <li>Iterable<Class_Name> saveAll(Iterable<Class_Name> iterable)</Class_Name></Class_Name></li>
</ul>

<p><strong>Delete Methods</strong></p>
<ul>
  <li>void deleteById(ID id)</li>
  <li>void delete (Class_Name object_Name)</li>
  <li>void deleteAll(Iterable<Class_Name> iterable)</Class_Name></li>
  <li>void deleteAll()</li>
</ul>

<h2 id="service-layer">Service Layer</h2>
<p>Controllers are supposed to be ‚Äúthin‚Äù and shouldn‚Äôt contain any real business logic. The controllers job is to simply handle the request and move the user into the correct view or return the response in an API call. We could have accessed the Repository from the Controller. However, as a best practice, it is much cleaner to have the Service Layer perform all of the access to the database. This practice refers to the Separation of Concerns pattern. The benefits a Service Layer provides is that it defines a common set of application operations available to different clients and coordinates the response in each operation.</p>

<h2 id="example">Example</h2>
<p>Let‚Äôs see all of the above concepts in action - our application will consist of Dog data stored in an in-memory H2 database.</p>

<h4 id="dependencies">Dependencies</h4>

<p>We‚Äôve added Spring Web, JPA and H2 dependencies:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>com.h2database<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>h2<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>
<p><br /></p>

<h4 id="h2-database">H2 database</h4>
<p>In our <code class="highlighter-rouge">application.properties</code> file, we‚Äôve enabled H2 database console and the database location:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>spring.h2.console.enabled=true
spring.h2.console.path=/h2
spring.datasource.url=jdbc:h2:mem:dogdata
</code></pre></div></div>
<p><br /></p>

<p>We‚Äôve created a <code class="highlighter-rouge">data.sql</code> file under <code class="highlighter-rouge">src/main/resources</code>:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">dog</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">breed</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'Fluffy'</span><span class="p">,</span> <span class="s1">'Pomeranian'</span><span class="p">,</span> <span class="s1">'Mountain View, CA'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">dog</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">breed</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'Spot'</span><span class="p">,</span> <span class="s1">'Pit Bull'</span><span class="p">,</span> <span class="s1">'Austin, TX'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">dog</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">breed</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'Ginger'</span><span class="p">,</span> <span class="s1">'Cocker Spaniel'</span><span class="p">,</span> <span class="s1">'Kansas City, KS'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">dog</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">breed</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'Lady'</span><span class="p">,</span> <span class="s1">'Direwolf'</span><span class="p">,</span> <span class="s1">'The North'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">dog</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">breed</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'Sasha'</span><span class="p">,</span> <span class="s1">'Husky'</span><span class="p">,</span> <span class="s1">'Buffalo, NY'</span><span class="p">);</span>
</code></pre></div></div>
<p><br /></p>

<h4 id="entity">Entity</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">shyamgupta</span><span class="o">.</span><span class="na">data</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.persistence.Entity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GeneratedValue</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.GenerationType</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.persistence.Id</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Dog</span> <span class="o">{</span>
	<span class="nd">@Id</span>
	<span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span><span class="o">=</span><span class="nc">GenerationType</span><span class="o">.</span><span class="na">AUTO</span><span class="o">)</span>
	<span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
	
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">breed</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">origin</span><span class="o">;</span>
	
<span class="c1">//Constructors	</span>
	<span class="kd">public</span> <span class="nf">Dog</span><span class="o">()</span> <span class="o">{}</span>
	
	<span class="kd">public</span> <span class="nf">Dog</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">breed</span><span class="o">,</span> <span class="nc">String</span> <span class="n">origin</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">();</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">breed</span> <span class="o">=</span> <span class="n">breed</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">origin</span><span class="o">;</span>
	<span class="o">}</span>

<span class="c1">//Getters and Setters</span>
	<span class="kd">public</span> <span class="nc">Long</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getBreed</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">breed</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBreed</span><span class="o">(</span><span class="nc">String</span> <span class="n">breed</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">breed</span> <span class="o">=</span> <span class="n">breed</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getOrigin</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="n">origin</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setOrigin</span><span class="o">(</span><span class="nc">String</span> <span class="n">origin</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">origin</span> <span class="o">=</span> <span class="n">origin</span><span class="o">;</span>
	<span class="o">}</span>
	
<span class="o">}</span>
</code></pre></div></div>

:ET